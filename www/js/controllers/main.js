// Generated by CoffeeScript 1.9.3
(function() {
  var hasProp = {}.hasOwnProperty;

  angular.module('perkkx.controllers.main', []).controller('MainCtrl', function($scope, $rootScope, $state, pxUserCred, pxBadgeProvider, $log, $ionicSideMenuDelegate) {

    /*
      Parent for the view controllers. manages the badges and all for the tabs
     */
    var callback;
    $scope.badges = {
      used: 0,
      disputed: 0
    };
    $scope.state = {
      sideBar: false
    };
    callback = function(obj) {
      var k, results, v;
      results = [];
      for (k in obj) {
        if (!hasProp.call(obj, k)) continue;
        v = obj[k];
        results.push($scope.setBadge(k, v));
      }
      return results;
    };
    $scope.setBadge = function(key, num) {
      return $scope.badges[key] = num;
    };
    $scope.menu = function() {
      return $ionicSideMenuDelegate.toggleLeft();
    };
    pxBadgeProvider.setUpdater(callback);
    return $rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams) {
      $log.info("Changing state from " + fromState.name + " to " + toState.name);
      if (toState.name === 'login' || toState.name === 'change_pass') {
        return $scope.state.sideBar = false;
      } else {
        return $scope.state.sideBar = true;
      }
    });
  }).controller('SideBarCtrl', function($scope, pxUserCred, $state, $ionicSideMenuDelegate) {

    /*
      Controller for the sidebar
     */
    $scope.data = {
      title: "Perkkx",
      vendor_name: '',
      username: ''
    };
    pxUserCred.register(function(id, name, username) {
      $scope.data.vendor_id = id;
      $scope.data.vendor_name = name;
      $scope.data.username = username;
      return $scope.state.registered = true;
    });
    $scope.logout = function() {
      $ionicSideMenuDelegate.toggleLeft(false);
      pxUserCred.logout();
      return $state.go('login');
    };
    return $scope.change_pass = function() {
      $ionicSideMenuDelegate.toggleLeft(false);
      return $state.go('change_pass');
    };
  });

}).call(this);
